
<!DOCTYPE html>
<html class='no-js' lang='en'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Node-StudentsCoursesManagementSystem</title>
    <link href="/css/application-a07755f5.css" rel="stylesheet" type="text/css" />
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/iconfont.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/ui.jqgrid.css">
    <link href="/css/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css">
    <link href="/css/tip-yellowsimple.css" rel="stylesheet" type="text/css">
  </head>
  <body class='main page'>
    <!-- Navbar -->
    <%- include('include/header') %> 
    <div id='wrapper'>
      <!-- Sidebar -->
      <%- include('include/sideBar') %>
      <!-- Tools -->
      <section id='tools'>
        <ul class='breadcrumb' id='breadcrumb'>
          <li class='active'>Students</li>
          <li><a href="/admin/student/import">Import Students</a></li>
        </ul>
      </section>
      <!-- Content -->
      <div id='content'>
        <div class='panel panel-default'>
          <div class='panel-heading'>
            All Students
          </div>
          <div class="panel-body">
            <div class="row searchbox">
              <div class="col-lg-4">
                <input type="text" class="form-control" placeholder="search..." autofocus id="keywordtext">
              </div>
            </div>
            
            <!-- Use jqGrid to make a table --> 
            <table id="list"></table> 
            <div id="listnav"></div>
            <input type="button" value="delete" id="delbtn">
          </div>
        </div>
        <a id="infotip" class="infotip" href="#"></a>
      </div>

    </div>
    <!-- Footer -->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.js"></script>
    <script type="text/javascript" src="/js/jquery.jqGrid.src.js"></script>
    <script type="text/javascript" src="/js/grid.locale-cn.js"></script>
    <script type="text/javascript" src="/js/jquery.poshytip.js"></script>
    <script>
        var lastsel;
        // initialize table
        $("#list").jqGrid( {
              //datatype : "local",
              datatype : "json",
              url : "/student",
              colNames : [ 'sid', 'name', 'grade', 'initial password'],
              colModel : [ 
                          {name : 'sid', index : 'sid',  width : 100 , key:true}, 
                          {name : 'name',index : 'name', width : 100 , editable : true}, 
                          { name : 'grade', 
                            index : 'grade',  
                            width : 100 , 
                            editable : true,
                            edittype:"select",
                            editoptions : {value : "middle1:middle1; middle2:middle2; middle3:middle3; high1:high1; high2:high2; high3:high3 "}
                          },
                          {name : 'password', index : 'password',  width : 100 , editable : true , key:true}, 
                        ],
              rowNum : 10,
              rowList : [ 10, 20, 30, 100 ],//how many rows u want to see in each page
              sortname : 'sid',
              pager : '#listnav',
              viewrecords: true,
              autowidth: true,
              height:400,
              cellEdit: true,
              cellsubmit:"clientArray",
              afterSaveCell: function(rowid,cellname,value,iRow,iCol) {
                  //alert(rowid);
                  //console.log(rowid,name,val,iRow,iCol)
                  var sid =$("#list").getCell(rowid,0);
                  console.log(sid,cellname,value)
                  //send request here
                  $.post("/student/"+sid,{
                     cellname:cellname,
                     value:value
                  },function(data){
                    console.log("data",data.result)
                    var result=data.result;
                    if(result==1){
                      //alert("success")
                      showTip("success");
                    }else if(result==-1){
                      showTip("cant find this student")
                    }else if(result==-2){
                      showTip("database error")
                    }
                  })
              }
        })

        function showTip(coutent){
          $('#infotip').poshytip({
            className: 'tip-yellowsimple',
            content: coutent,
            showOn: 'none',
            alignTo: 'target',
            alignX: 'inner-left',
            offsetX: 0,
            offsetY: 5
          });
          //$('#delbtn').click(function() { 
            //$('#infotip').poshytip('show').poshytip('showDelayed', 2000);
            $('#infotip').poshytip('show').poshytip('hideDelayed', 1000);
          //});
        }

        //bind("input" realtime input captrue
        $("#keywordtext").bind("input",function(){
          //console.log($(this).val())
          var keyword=$(this).val();
          // send ajax request
          $("#list").jqGrid('clearGridData');  
          $("#list").jqGrid('setGridParam',{
                    datatype:'json',
                    postData:{'keyword':keyword}, //send data 
                    }).trigger("reloadGrid");

        });
    </script>

  </body>
</html>
